using AgileCore.Core.Data.FormEx;
using InsuranceApp.Models;
using MerchantClient.Server.Observer;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using System.Web.Mvc;

namespace InsuranceApp.Areas.CommonProduct.Controllers
{
    [ApiHandleError]    
    public class ExploitController : ContextController
    {
        // GET: CommonProduct/Exploit
        public ActionResult Index()
        {
            return View();
        }


        public ActionResult Browse(string url)
        {
            int nViewID = 0;
            if (this.AuthInfoCurrent != null) {
                MerchantClient.Server.Observer.ViewSerivice viewSerivice = new MerchantClient.Server.Observer.ViewSerivice();
                var hR= viewSerivice.Handler(url, this.AuthInfoCurrent.StoreCustomID, this.AuthInfoCurrent.UserID, 
                    this.AuthInfoCurrent.StoreIntroducerID, this.AuthInfoCurrent.VisitID);
                if (hR != null && hR.Model != null)
                    nViewID = hR.Model.ID;
            }
            return Json(new ResultModel() { Data=nViewID });
        }

        public ActionResult Trigger(string url, int viewid, TriggerInfo triggerInfo)
        {
            TriggerService trgSvr = new TriggerService();
            trgSvr.Handler(url, viewid, triggerInfo);
            return Json(new ResultModel());
        }
    }
}